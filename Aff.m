%affine transformation of coordinates--------------------------------------

function Y=aff(E,M)
Y(:,:,:,1) = E(:,:,:,1)*M(1,1) + E(:,:,:,2)*M(1,2) + E(:,:,:,3)*M(1,3) + M(1,4);
Y(:,:,:,2) = E(:,:,:,1)*M(2,1) + E(:,:,:,2)*M(2,2) + E(:,:,:,3)*M(2,3) + M(2,4);
Y(:,:,:,3) = E(:,:,:,1)*M(3,1) + E(:,:,:,2)*M(3,2) + E(:,:,:,3)*M(3,3) + M(3,4);
end
